{
	"QIIME" : {
		"dockerimage" : "qiime:1.8.0-amd64u",
		"commands" : {
			"pick_closed_reference_otus" : {
				"default" : {
					"input" : [ 
						{	"type"	: "file",
							"name"	: "INPUT-FILE",
							"required" : true
						},
						{	"type"	: "file",
							"name"	: "INPUT-PARAMETER",
							"required" : true
						},
						{	"type"	: "string",
							"name"	: "IDENTITY",
							"default_value" : "97",
							"description" : "percent identity"
						},
						{	"type"	: "string",
							"name"	: "OUTPUT-DIR",
							"default_value" : "ucr",
							"description" : "output directory"
						}
						],
					"output_array" : ["${OUTPUT-DIR}/otu_table.biom"],
					"output_map" : {},
					"cmd_interpreter" : "/bin/bash",
					"cmd_script" : 
						[
						"source /home/qiime/qiime_software/activate.sh",
						"pick_closed_reference_otus.py -i @${INPUT-FILE} -o ${OUTPUT-DIR} -p @${INPUT-PARAMETER} -r /home/qiime/qiime_software/gg_otus-13_8-release/rep_set/${IDENTITY}_otus.fasta"
						],
					"example" : "QIIME.pick_closed_reference_otus(input.fas, param.txt, IDENTITY=90)",
					"example_interface" : "file INPUT-FILE, file INPUT-PARAMETER, number IDENTITY=97, string OUTPUT-DIR=ucr, file *array, **dict"
				}
			}
		}
	},
	"PIRCUSt" : {
		"dockerimage" : "picrust:1.0.0",
		"commands" : {
			"normalize_by_copy_number" : {
				"default" : {
					"input" : [
						{	"type"	: "file",
							"name"	: "INPUT",
							"required" : true,
							"description" : "input biom file"
						}
						],
					"cmd_script" :
						[
						"mkdir -p /usr/local/lib/python2.7/dist-packages/picrust/data/",
						"ln -s /db/16S_13_5_precalculated.tab.gz  /usr/local/lib/python2.7/dist-packages/picrust/data/16S_13_5_precalculated.tab.gz",
						"ln -s /db/ko_13_5_precalculated.tab.gz  /usr/local/lib/python2.7/dist-packages/picrust/data/ko_13_5_precalculated.tab.gz",
						"normalize_by_copy_number.py -i @${INPUT} -o ${OUTPUT-FILE}"
						],
					"output_array" : ["${OUTPUT-FILE}"],
					"variables" : [{ "OUTPUT-FILE" : "${remove_extension:${INPUT}}.normalized.biom"}],
					"predata": {
                    				"ko_13_5_precalculated.tab.gz":{
                        				"url" : "http://shock.metagenomics.anl.gov:80/node/e91dd6b3-69b0-4e1f-9cb0-1b94fb9864d0?download"
                    				},
						"16S_13_5_precalculated.tab.gz" : {
							"url" : "http://shock.metagenomics.anl.gov:80/node/ac5952b4-cb43-410c-b545-8855131df518?download"
						}
					}
				}
			},
			"predict_metagenomes" : {
				"default" : {
					"input" : [
						{	"type"	: "file",
							"name"	: "INPUT",	
							"required" : true,
							"description" : "normalized input biom file"
						}
						],
					"cmd_script" :
						[
						"mkdir -p /usr/local/lib/python2.7/dist-packages/picrust/data/",
						"ln -s /db/16S_13_5_precalculated.tab.gz  /usr/local/lib/python2.7/dist-packages/picrust/data/16S_13_5_precalculated.tab.gz",
						"ln -s /db/ko_13_5_precalculated.tab.gz  /usr/local/lib/python2.7/dist-packages/picrust/data/ko_13_5_precalculated.tab.gz",
						"predict_metagenomes.py -i @${INPUT} -o ${OUTPUT-FILE}"
						],
					"output_array" : ["${OUTPUT-FILE}"],
					"variables" : [{ "OUTPUT-FILE" : "${remove_extension:${INPUT}}.picrust.biom"}],
					"predata": {
                    				"ko_13_5_precalculated.tab.gz":{
                        				"url" : "http://shock.metagenomics.anl.gov:80/node/e91dd6b3-69b0-4e1f-9cb0-1b94fb9864d0?download"
                    				},
						"16S_13_5_precalculated.tab.gz" : {
							"url" : "http://shock.metagenomics.anl.gov:80/node/ac5952b4-cb43-410c-b545-8855131df518?download"
						}
					}
				}
			}
		}
	},
	"Emirge" : {
		"dockerimage" : "wgerlach/emirge:20130227",
		"_dockerimage" : "wgerlach/emirge:0.60",
		"dockerimages" : {
			"0.60" 		: "wgerlach/emirge:0.60",
			"20130227" 	: "wgerlach/emirge:20130227"
		},
		"commands" : {
			"emirge" : {
				"default" : {
					"input" : [
						{	"type"	: "file",
							"name"	: "INPUT1",
							"description" : "input biom file"
						},
						{	"type"	: "file",
							"name"	: "INPUT2",
							"optional" : true,
							"option" : "-2 ",
							"description" : "input biom file, second read in mate-pairs"
						},
						{	"type"	: "string",
							"name"	: "insert_mean",
							"default_value" : "180",
							"description" : "insert size mean"
						},
						{	"type"	: "string",
							"name"	: "insert_stddev",
							"default_value" : "20",
							"description" : "insert standard deviation"
						},
						{	"type"	: "string",
							"name"	: "max_read_length",
							"default_value" : "110",
							"description" : "maximal read length"
						},
						{	"type"	: "string",
							"name"	: "processors",
							"default_value" : "${NumCPU}",
							"description" : "number of processor to use, default all"
						},
						{	"type"	: "string",
							"name"	: "iterations",
							"default_value" : "40",
							"valid_values" : ["00", "01", "10", "20", "30", "40"],
							"description" : "number of iterations"
						}
						],
					"cmd_script" :
						[
						"set -xe",
						"emirge.py outdir -1 ${INPUT1} ${option:INPUT2}} -f ./SSURef_111_candidate_db.fasta -b ./SSU_candidate_db_btindex --insert_mean=${insert_mean} --insert_stddev=${insert_stddev} --max_read_length=${max_read_length} --processors=${processors} --phred33 --iterations=${iterations}",
						"apt-get --force-yes -y install python-biopython",
						"emirge_rename_fasta.py outdir/iter.${iterations} > emirge.fas"
						],
					"output_array" : ["emirge.fas"],
					"predata": {
                    				"SSU_candidate_db_btindex.1.ebwt":{
                        				"url" : "http://shock.metagenomics.anl.gov:80/node/e401783f-7f9b-486a-ad64-1d8cc8c5e3a6?download"
                    				},
						"SSU_candidate_db_btindex.2.ebwt" : {
							"url" : "http://shock.metagenomics.anl.gov:80/node/2ae51a86-2dc3-46cb-8f90-0a6e103cf857?download"
						},
						"SSU_candidate_db_btindex.3.ebwt" : {
							"url" : "http://shock.metagenomics.anl.gov:80/node/c6382101-c67d-4f05-b05e-8a863d6c2abb?download"
						},
						"SSU_candidate_db_btindex.4.ebwt" : {
							"url" : "http://shock.metagenomics.anl.gov:80/node/490f51f0-5b39-4b93-ba3d-1caadbdd5e54?download"
						},
						"SSU_candidate_db_btindex.rev.1.ebwt" : {
							"url" : "http://shock.metagenomics.anl.gov:80/node/e680556c-751a-4a59-b5ad-be20a1614cb2?download"
						},
						"SSU_candidate_db_btindex.rev.2.ebwt" : {
							"url" : "http://shock.metagenomics.anl.gov:80/node/951420f9-4c87-44a7-ac56-c94cd06e2166?download"
						},
						"SSURef_111_candidate_db.fasta" : {
							"url" : "http://shock.metagenomics.anl.gov:80/node/44784ee0-12eb-49c0-b609-76ee30d152af?download"
						}
					}
				}
			}
		
		}
	},
	"MG-RAST-Tools" : {
		"dockerimage" : "mgrasttools:20140701",
		"commands" : {
			"mg-kegg2ss" : {
				"default" : {
					"input" : [
						{	"type"	: "file",
							"name"	: "INPUT",
							"description" : "input biom file"
						},
						{	"type"	: "string",
							"name"	: "OUTPUT-FILE-NAME",
							"default_value" : "kegg2ss.txt"
						},
						{	"type"	: "string",
							"name"	: "OUTPUT-TYPE",
							"default_value" : "biom",
							"valid_values" : ["biom", "text"],
							"description" : "biom or text for tabbed table"
						}
						],
					"cmd_script" :
						[
						"source /python_env",
						"mg-kegg2ss.py --input ${INPUT} --output ${OUTPUT-TYPE} > ${OUTPUT-FILE-NAME}"
						],
					"output_array" : ["${OUTPUT-FILE-NAME}"]
				}
			}
		}
	},
	"AMETHST" : {
		"dockerimage" : "keegan/amethst:20140818",
		"commands" : {
			"amethst" : {
				"compute" : {
					"input" : [
						{	"type"	: "file",
							"name"	: "COMMAND-FILE",
							"description" : "input command_file"
						},
						{	"type"	: "string",
							"name"	: "ANALYSIS-OUTPUT",
							"default_value" : "analysis.RESULTS.tar.gz"
						}
						],
					"cmd_script" :
						[
						"export PATH=$PATH:/AMETHST",
						"AMETHST.pl --command_file ${COMMAND-FILE} -z --all_name ${ANALYSIS-OUTPUT}"
						],
					"output_array" : ["${ANALYSIS-OUTPUT}"]
				},
				"compile-summary" : {
					"input" : [
						{	"type"	: "string",
							"name"	: "OUTPUT-ZIP",
							"default_value" : "AMETHST_Summary.tar.gz"
						},
						{	"type"	: "*file",
							"name"	: "ANALYSIS-RESULTS",
							"description" : "analysis results from compute step"
						}
						],
					"cmd_script" :
						[
						"export PATH=$PATH:/AMETHST",
						"AMETHST.pl -c --summary_name=${OUTPUT-ZIP}"
						],
					"output_array" : ["${OUTPUT-ZIP}"]
				}
			}
		}
	},
	"CAP" : {
		"dockerimage" : "cap:20141015",
		"commands" : {
			"coverage-bed-reference" : {
				"default" : {
					"input" : [
							   {
							   "type"	: "file",
							   "name"	: "INPUT",
							   "description" : "input FASTA file"
							   }
					],
					"cmd_script" : [
						"python /cap/scripts/coverage-bed-reference.py ${INPUT}"
					],
					"output_array" : ["${INPUT}.bed"]
				}
				
			},
			"get-rpkm" : {
				"default" : {
					"input" : [
							   {
							   "type"	: "file",
							   "name"	: "INPUT",
							   "description" : ""
							   }
							   ],
					"cmd_script" : [
									"python /cap/scripts/get-rpkm.py ${INPUT}"
									],
					"output_array" : ["${INPUT}.rpkm"]
				}
			},
			"final" : {
				"default" : {
					"input" : [
							   {
							   "type"	: "string",
							   "name"	: "MGMID",
							   "default_value" : "mgm identifier"
							   },
							   {
							   "type"	: "list",
							   "name"	: "RPKM-FILES",
							   "description" : ""
							   },
							   {
							   "type"	: "file",
							   "name"	: "METATXT",
							   "filename" : "meta.txt",
							   "description" : "",
							   "optional" : true
							   }
							   ],
					"cmd_script" : [
									"python /cap/scripts/merge.py *rpkm",
									"curl \"http://api.metagenomics.anl.gov/1/annotation/similarity/${MGMID}?type=ontology&source=Subsystems\" > annotations.txt",
									"python /cap/scripts/best-hit.py annotations.txt",
									"R < /cap/scripts/core.R --vanilla"
									],
					"output_array" : ["metag.RData"]
				}
			}
		}
	},
	"Bowtie2" : {
		"dockerimage" : "skyport/bowtie2:2.1.0",
		"commands" : {
			"bowtie2-build" : {
				"default" : {
					"input" : [
							   {
							   "type"	: "file",
							   "name"	: "INPUT",
							   "description" : "input FASTA file to create database of"
							   }
							   ],
					"variables" : [{ "PREFIX" : "${remove_extension:${INPUT}}.bowtie_db"}],
					"cmd_script" : [
									"bowtie2-build ${INPUT} ${PREFIX}"
									],
					"output_array" : ["${PREFIX}.1.bt2", "${PREFIX}.2.bt2", "${PREFIX}.3.bt2", "${PREFIX}.4.bt2", "${PREFIX}.rev.1.bt2", "${PREFIX}.rev.2.bt2"]
				}
			},
			"bowtie2" : {
				"default" : {
					"input" : [
							   {
							   "type"	: "file",
							   "name"	: "INPUT",
							   "description" : "input FASTA file to map"
							   },
							   {
							   "type"	: "file",
							   "name"	: "DB.1.bt2",
							   "description" : "bowtie database file"
							   },
							   {
							   "type"	: "file",
							   "name"	: "DB.2.bt2",
							   "description" : "bowtie database file"
							   },
							   {
							   "type"	: "file",
							   "name"	: "DB.3.bt2",
							   "description" : "bowtie database file"
							   },
							   {
							   "type"	: "file",
							   "name"	: "DB.4.bt2",
							   "description" : "bowtie database file"
							   },
							   {
							   "type"	: "file",
							   "name"	: "DB.rev.1.bt2",
							   "description" : "bowtie database file"
							   },
							   {
							   "type"	: "file",
							   "name"	: "DB.rev.2.bt2",
							   "description" : "bowtie database file"
							   }
							   ],
					"variables" : [{ "DBPREFIX" : "${remove_extension:${remove_extension:${DB.1.bt2}}}",
								     "OUTPUT" : "${remove_extension:${INPUT}}.sam"
								   }],
					"cmd_script" : [
									"bowtie2 -x ${DBPREFIX} -f ${INPUT} -S ${OUTPUT}"
									],
					"output_array" : ["${OUTPUT}"]
				}
			}
		}
		
	},
	"Samtools" : {
		"dockerimage" : "cap:20141015",
		"commands" : {
			"samtools" : {
				"view" : {
					"input" : [
							   {
							   "type"	: "file",
							   "name"	: "INPUT",
							   "description" : "SAM or BAM input"
							   },
							   {
							   "type"	: "file",
							   "name"	: "REFERENCE",
							   "description" : "input FASTA file"
							   }
							   ],
					"cmd_script" : [
									"samtools view -b -t ${REFERENCE} ${INPUT} -o ${INPUT}.bam"
									],
					"output_array" : ["${INPUT}.bam"]
				}
				
			}
		}
	},
	"Bedtools" : {
		"dockerimage" : "cap:20141015",
		"commands" : {
			"bedtools" : {
				"bamtobed" : {
					"input" : [
							   {
							   "type"	: "file",
							   "name"	: "INPUT",
							   "description" : "BAM input"
							   }
							   ],
					"cmd_script" : [
									"bedtools bamtobed ${OPTIONS} -i ${INPUT} > ${INPUT}.bed"
									],
					"output_array" : ["${INPUT}.bed"],
					"help" : "bedtools bamtobed",
					"options_prefix" : " -"
				}
			},
			"coverageBed" : {
				"default" : {
					"input" : [
							   {
							   "type"	: "file",
							   "name"	: "INPUT",
							   "description" : ""
							   },
							   {
							   "type"	: "file",
							   "name"	: "BEDFILE",
							   "description" : ""
							   }
							   ],
					"cmd_script" : [
									"coverageBed -a ${INPUT} -b ${BEDFILE} > ${INPUT}.reads.mapped"
									],
					"output_array" : ["${INPUT}.reads.mapped"]
				}
			}
		}
	}
}
